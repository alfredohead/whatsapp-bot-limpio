name: Fly Deploy
on:
  push:
    branches:
      - main
env:
  FLY_API_TOKEN: ${{fm2_lJPECAAAAAAACHzuxBCAoGIUASBpHqAXQ1ORbzADwrVodHRwczovL2FwaS5mbHkuaW8vdjGUAJLOAA+yrR8Lk7lodHRwczovL2FwaS5mbHkuaW8vYWFhL3YxxDwPEhcwpUMTaAJF8x/WuQdI7k622YOLKxsgUMT1xEDRBi7sxFLAgnbjZGJP6SA1xeLaH5/433i4vvmcH3TETgMr3hH5gByxJaKeSGv/M6rYYKLPtE43V0sZKHrApEtbyzo3DgELGWxiy/ZgfyrNfjzkcBnhpaXGsQN5Qb9GYJer2nqy13awEnp5l0WppsQgaomRvQiNUiI5cNGil9/NwXYOyZBH/TC4Fa+83G4tuNk=,fm2_lJPETgMr3hH5gByxJaKeSGv/M6rYYKLPtE43V0sZKHrApEtbyzo3DgELGWxiy/ZgfyrNfjzkcBnhpaXGsQN5Qb9GYJer2nqy13awEnp5l0WppsQQ9b2wDN2PWg/nWx1W/93lucO5aHR0cHM6Ly9hcGkuZmx5LmlvL2FhYS92MZYEks5oUhcbzmhSGZEXzgAPF7cKkc4ADxe3xCAKM9dUjzX+l1bPTvbQ5Zp9I8eDPgeAm6dLeB14Q2MXMQ==,fo1_Cp_kbUBHusagqL4QUGEBkBMeJp3sHPaFn5CdSyX7f6g}}

jobs:
  deploy:
    name: Deploy app
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
          cache: 'npm'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Setup Flyctl
        uses: superfly/flyctl-actions/setup-flyctl@master
        
      - name: Deploy to Fly.io
        run: flyctl deploy --remote-only